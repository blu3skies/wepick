language: ruby
rvm:
- 2.6.5
env:
  global:
  - CC_TEST_REPORTER_ID=6ff37add0aecefe2ddea29e8ebbb74798071c5c2fcf9cf90e27bdb89196896bb
services:
- postgresql
before_script:
- bundle exec rails db:create
- bundle exec rails db:migrate
- curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64
  > ./cc-test-reporter
- chmod +x ./cc-test-reporter
- "./cc-test-reporter before-build"
cache:
  bundler: true
  directories:
  - node_modules
  yarn: true
install:
- bundle install
- nvm install node
- node -v
- npm i -g yarn
- yarn
script:
- bundle exec rails webpacker:compile
- bundle exec rspec
- bundle exec rubocop
branches:
  only:
  - master
after_script:
- "./cc-test-reporter after-build -t simplecov --exit-code $TRAVIS_TEST_RESULT"
deploy:
  provider: heroku
  skip_cleanup: true
  app: wepick
  on:
    repo: jasylwong/wepick
  run:
  - bundle exec rails db:migrate
  - bundle exec rails db:seed
  api_key:
    secure: CAq8Z7Yh/k+Sx4n2omaTZHLdqszSUGTwf4K4ZpbfdCNTHtkilTMRfy79k0zr+R0Jzb7nZUg2q0DdJP72pGkfryo5zD8cCbjSCGbUs5sUgVmtzu+ooGgngFCHUENgVL2ofMXwMmiiKnygRKg+EkZAek2bTu+EN8og2T4CNxDA/6DIwPnX7y7gt0sxKv0qaahhSzfCfe6zCBGaDM6um7queG1VkCHrOgUfD3GH0d6Tlox8GTihTy2yH4l/6A7ls5bwbJ9cK1LfM8bSR4Jv98fLHeZ2nA0h/EXOiR3TYHhvzgkGRcNPA9budlQmOjehjR16difhmMN+gbHPl/HXEFB3g9vdd1f+pReEBHiSQo/L19V9W0GEBnfkPJHtoETHFHW3xvDv2aI7KVVjToJFrnxNMW7BN7+XzZVZ2+qUG9p29gAmVuUNfAp89leJjTl2cgYFYmmX8eaiEX08jv0UdQTFhjxElfd8IBsNO/ctA4Cf3vKmyreHVdzuLtu2A4UxIqdHdonR/xlLt7IokBZgSRkRFFLTh+ju1/0dKtEK+umOZlFwUTd24dNDjsS3Crhzocgy1nNczTwHpQB9HOuI+JT8B/2bENDZqMdp2volRfwkZjbHHFThJq/H6cK8v5BJ9ICS7MPpejH8SbOSHx0uiiEES4572ekz7m5ifJ5RzncDjAU=
